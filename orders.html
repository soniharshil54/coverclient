<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>phone case</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="dist/css/tagstyle.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <style type="text/css">
    #testtr{
      color: red
    }

    #example1_filter {
  text-align: right;
}

    #fromdatediv{
      display: none;
    }

    #todatediv{
      display: none;
    }

    .custom-select-nn{
    padding: 0px;height: 20px;font-size: 14px;border: 0px;box-shadow: none;text-align: center;-webkit-appearance: none;
    }

    @media (min-width: 576px){
    .modal-dialog {
      max-width: 550px;
      margin: 1.75rem auto;
    }
    }

    @media (min-width: 576px){
    .modal-content {
      box-shadow: none;
    }
    }

            body
    {
        counter-reset: Serial;           /* Set the Serial counter to 0 */
    }

    .auto-index td:first-child:before
{
  counter-increment: Serial;      /* Increment the Serial counter */
  content: counter(Serial); /* Display the counter */
}



  </style>
</head>
<!-- <body class="hold-transition sidebar-mini"> -->
  <body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">

<!-- Site wrapper -->
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
      </li>
    </ul>


    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <!-- Messages Dropdown Menu -->
      <li class="nav-item dropdown">
        <!-- <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-comments"></i>
          <span class="badge badge-danger navbar-badge">3</span>
        </a> -->
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Brad Diesel
                  <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">Call me whenever you can...</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  John Pierce
                  <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">I got your message bro</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <!-- Message Start -->
            <div class="media">
              <img src="dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
              <div class="media-body">
                <h3 class="dropdown-item-title">
                  Nora Silvester
                  <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                </h3>
                <p class="text-sm">The subject goes here</p>
                <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
              </div>
            </div>
            <!-- Message End -->
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
        </div>
      </li>
      <!-- Notifications Dropdown Menu -->
      <li class="nav-item dropdown">
        <!-- <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-bell"></i>
          <span class="badge badge-warning navbar-badge">15</span>
        </a> -->
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <span class="dropdown-item dropdown-header">15 Notifications</span>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="fas fa-envelope mr-2"></i> 4 new messages
            <span class="float-right text-muted text-sm">3 mins</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="fas fa-users mr-2"></i> 8 friend requests
            <span class="float-right text-muted text-sm">12 hours</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="fas fa-file mr-2"></i> 3 new reports
            <span class="float-right text-muted text-sm">2 days</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
        </div>
      </li><!-- 
      <li class="nav-item">
        <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#">
          <i class="fas fa-th-large"></i>
        </a>
      </li> -->
    </ul>
  </nav>
  <!-- /.navbar -->

   <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
      <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
           style="opacity: .8">
      <span class="brand-text font-weight-light">phone case</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item has-treeview menu-open">
            <a href="index.html" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Dashboard
                <!-- <i class="right fas fa-angle-left"></i> -->
              </p>
            </a>
          </li>
                    <li class="nav-item has-treeview menu-open">
            <a href="slider.html" class="nav-link">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Main Categories
                <!-- <i class="right fas fa-angle-left"></i> -->
              </p>
            </a>
          </li>
        <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-circle"></i>
              <p>
                Products
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item has-treeview">
                <a href="#" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>
                    Phonecase
                    <i class="right fas fa-angle-left"></i>
                  </p>
                </a>
                <ul class="nav nav-treeview">
                  <li class="nav-item">
                    <a href="company.html" class="nav-link">
                      <i class="far fa-dot-circle nav-icon"></i>
                      <p>Phone Company List</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="addmodel.html" class="nav-link">
                      <i class="far fa-dot-circle nav-icon"></i>
                      <p>Add Model</p>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="modellist.html" class="nav-link">
                      <i class="far fa-dot-circle nav-icon"></i>
                      <p>Model List</p>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fas fa-copy"></i>
              <p>
                Offers
                <i class="fas fa-angle-left right"></i>
                <!-- <span class="badge badge-info right">6</span> -->
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="addoffer.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Add Offer</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="offerlist.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Offer List</p>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item has-treeview">
            <a href="modelrequest.html" class="nav-link">
              <i class="nav-icon fas fa-tree"></i>
              <p>
                New Model Requests
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <a href="notification.html" class="nav-link">
              <i class="nav-icon fas fa-tree"></i>
              <p>
                Notifications
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <a href="sms.html" class="nav-link">
              <i class="nav-icon fas fa-tree"></i>
              <p>
                SMS
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <a href="users.html" class="nav-link">
              <i class="nav-icon fas fa-edit"></i>
              <p>
                User List
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <a href="orders.html" class="nav-link active">
              <i class="nav-icon fas fa-table"></i>
              <p>
                Orders
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <a href="cpassword.html" class="nav-link">
              <i class="nav-icon fas fa-table"></i>
              <p>
                Change Password
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </a>
          </li>
          <li class="nav-item has-treeview">
            <button onclick="logOutUser()" style="width: 100%" class="nav-link">              
              <p>
                Logout
                <!-- <i class="fas fa-angle-left right"></i> -->
              </p>
            </button>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>


  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
     <div class="row">
        <div class="col-md-12">
          <div class="card card-secondary">
            <div class="card-header">
              <h3 id="productAddHeading" class="card-title">Filter Orders</h3>

              <!-- <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" title="Collapse">
                  <i class="fas fa-plus"></i></button>
              </div> -->
            </div>
            <div  class="card-body" style="display: block;">
                
                                <div class="row">
                    <div class="col-sm-2">
                      <!-- text input -->
                      <div class="form-group">
                        <label>Date</label>
                          <select onchange="filterdatecustom()" id="filter_range" class="form-control custom-select">
                  <option>All</option>          
                  <option>Today</option>  
                  <option>Yesterday</option>         
                 <option>Last Week</option>
                  <option>Last Month</option>
                  <option>Custom</option>
                </select>
                      </div>
                    </div>
                    <div id="fromdatediv" class="col-sm-2">
                      <label>From</label>
                      <input id="from_date_c" type="date" class="form-control" name="fromdate">
                      
                    </div>
                    <div id="todatediv" class="col-sm-2">
                      <label>To</label>
                      <input id="to_date_c" type="date" class="form-control" name="todate">
                    </div>

                      <div style="float: right;" class="col-sm-2">
                      <!-- text input -->
                      <div class="form-group">
                        <label>Order Status</label>
                           <select id="sel_status" class="form-control custom-select">
                  <option>All</option>          
                  <option>Pending Payment</option>
                  <option>Processing</option>
                  <option>Failed</option>
                  <option>On hold</option>
                  <option>Refunded</option>
                  <option>Trash</option>
                  <option>Completed</option>
                </select>
                      </div>
                    </div>   
                    <div class="col-sm-4">
                      <p></p>
                      <button onclick="filterorders()" style="float: right;margin-right: 30px"  class="btn btn-success">Filter Orders</button>
                    </div>              

                      </div>
                  
                  <div class="row">
                     
                  </div>
                                       
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
      
     <div class="col-md-12">

    <section class="content">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <div class="row">
                <div class="col-sm-3">
                     <h3 class="card-title">Orders</h3>
                  </div>
                  <div class="col-sm-5">
                    <span style="color: green; font-weight: bold;" id="confirmDelete"></span>
                  </div>
                  <div class="col-sm-2">
                    <div style="float: right;" class="download-wrapper" onClick="download()">
                  <button class="btn btn-success">Export to csv</button>
                </div>
                  </div>
                <div class="col-sm-2">
                     <h3 class="card-title" style="float: right"></h3>
                  </div>
                  
                  
              </div>
             
                
            </div>

            <!-- /.card-header -->
            <div class="card-body">
              
              <table id="example1" class="table table-bordered table-striped">
                <thead>
                <tr>
                  <th>No.</th>
                  <th>Order Id</th>
                  <th>Products</th>
                  <th>Amount</th>
                  <th>Payment</th>  
                  
                  <th>Date</th>
                  <th>User Info</th>
                  <th>Status</th>
                  <th><div class='form-group'><div class='custom-control custom-checkbox'><input onclick="checkAll()" class='custom-control-input' type='checkbox' id='customCheckbox2' value='option1'><label for='customCheckbox2' class='custom-control-label'><button onclick="opendeletemodal()" class="btn btn-danger">Delete All</button></label></div></div></th>            
                </tr>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                <tr>
                  <th>No.</th>
                  <th>Order Id</th>
                  <th>Products</th>
                  <th>Amount</th>
                  <th>Payment</th>  
                  <th>Date</th>
                  <th>User Info</th>
                  <th>Status</th>
                  <th><div class='form-group'><div class='custom-control custom-checkbox'><input onclick="checkAll()" class='custom-control-input' type='checkbox' id='customCheckbox3' value='option1'><label for='customCheckbox3' class='custom-control-label'><button onclick="opendeletemodal()" class="btn btn-danger">Delete All</button></label></div></div></th>
                </tr>
                </tfoot>
              </table>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    </div>

    </div>
   
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

<footer class="main-footer">
  <strong>Call us:  <a href="#">+91 8866220223</a>.</strong> 
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>


 <div class="modal" id="deleteModal">
    <div class="modal-dialog">
      <div class="modal-content" style="border: none">

        <!-- Modal Header -->
        <!-- <div class="modal-header" style="">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div> -->
        
        <!-- Modal body -->
        <div class="modal-body" style="text-align: center;">
          <!-- <h1>ello</h1> -->
          <div class="row">
            <div style="margin-bottom: 30px" class="col-sm-12">
              <span>Are you sure you want to delete selected records ??</span>
            </div>
            <div class="col-sm-6"></div>
            <div class="col-sm-6">
              <div class="form-group">
               <input style="margin-right: 20px" id="productEditBtn" onclick="deletekeychains()" type="button" value="Confirm" class="btn btn-success float-right">
               <input style="margin-right: 20px" id="productEditBtn" onclick="canceldelete()" type="button" value="Cancel" class="btn btn-danger float-right">
             </div>

           </div> 
         </div>
       </div>

       <!-- Modal footer -->
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div> -->
        
      </div>
    </div>
  </div>



      <!-- The Modal -->
  <div class="modal" id="cartUserModal">
    <div class="modal-dialog">
      <div class="modal-content" style="background-color: white;border: none">
        <div class="modal-body" style="text-align: left;">
         <span style="font-weight: bold;" id="cart_u_name"></span><br>
         <span id="cart_u_address"></span><br>
         <span id="cart_u_city"></span><span id="cart_u_pincode"></span><br>
         <span id="cart_u_state"></span><br>
         <span id="cart_u_contact"></span><br>
         <span id="cart_u_email"></span>
         

        </div>
        
      </div>
    </div>
  </div>


    <!-- The Modal -->
  <div class="modal" id="cartProductModal">
    <div class="modal-dialog">
      <div class="modal-content" style="background-color: transparent;border: none">
      
        <!-- Modal Header -->
        <!-- <div class="modal-header" style="">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div> -->
        
        <!-- Modal body -->
        <div class="modal-body" style="text-align: center;">
          <table class="table table-dark" style="width:100%">
            <tr>
              <th>Product Name:</th>
              <td><span id="cart_p_name"></span></td>
            </tr>
              <tr>
              <th>Order Id:</th>
              <td><span id="cart_order_id"></span></td>
            </tr>
            <tr>

              <th>Image:</th>
              <td>
      <img id="cart_p_image" src="images/3.jpg" alt="W3Schools" style="max-height: 200px; max-width: 200px">
      <img id="cart_p_c_image" src="images/3.jpg" alt="W3Schools" style="max-height: 200px; max-width: 200px">
      
            </tr>
            <tr>
              <th>Print Name:</th>
              <td><span id="cart_p_printname"></span></td>
            </tr>
             <tr>
              <th>Size:</th>
              <td><span id="cart_p_size"></span></td>
            </tr>
             <tr>
              <th>Cover type:</th>
              <td><span id="cart_p_covertype"></span></td>
            </tr>
            <tr>
              <th>Quantity:</th>
              <td><span id="cart_p_quantity"></span></td>
            </tr>
          </table>
          <!-- <h1>ello</h1> -->
          <!-- <img style="max-width: 500px" id="imgModal" style="" src="images/3.jpg"> -->

        </div>
        
        <!-- Modal footer -->
        <!-- <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div> -->
        
      </div>
    </div>
  </div>
<!-- ./wrapper -->
 <!-- <h2>Modal Example</h2> -->
  <!-- Button to Open the Modal -->
  <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
    Open modal
  </button> -->
  <!-- The Modal -->

  
</div>


<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="plugins/datatables/jquery.dataTables.js"></script>
<script src="plugins/datatables-bs4/js/dataTables.bootstrap4.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script src="hosturl.js"></script>






<!-- <script type="text/javascript">
  function getdatafortable(unfiltered){
    var filters = ["name","size","price"];
    let filtered = JSON.parse(unfiltered).map(function(currObj) {
  var temp = {};
  for identifier in filters:
    temp[identifier] = currObj[identifier];
  return temp;
});
    return filtered
  }
</script> -->


<script type="text/javascript">

$('#cart_p_image').on('click', function () {
    $.ajax({
        url: `http://${hosturl}:5600/admin/uploads/${productGimagefull}`,
        method: 'GET',
        xhrFields: {
            responseType: 'blob'
        },
        success: function (data) {
            var a = document.createElement('a');
            var url = window.URL.createObjectURL(data);
            a.href = url;
            a.download = productGimagefull;
            document.body.append(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);
        }
    });
});

$('#cart_p_c_image').on('click', function () {
    $.ajax({
        url: `http://${hosturl}:5600/admin/uploads/${productGimagecropped}`,
        method: 'GET',
        xhrFields: {
            responseType: 'blob'
        },
        success: function (data) {
            var a = document.createElement('a');
            var url = window.URL.createObjectURL(data);
            a.href = url;
            a.download = productGimagecropped;
            document.body.append(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);
        }
    });
});

</script>

<script type="text/javascript">

  function filterdatecustom(){
    let filterrange = document.getElementById("filter_range").value
    if(filterrange === "Custom"){
      document.getElementById("fromdatediv").style.display = "block"
      document.getElementById("todatediv").style.display = "block"
    }
    else {
            document.getElementById("fromdatediv").style.display = "none"
      document.getElementById("todatediv").style.display = "none"
    }
  }



  function filterorders(){
    let filterdaterange = document.getElementById("filter_range").value
    let filterstatus = document.getElementById("sel_status").value
    let teststatus = okchains.map(a => ({...a}));
    if (filterdaterange === "All") {
      filterbystatus()
    }
    else if(filterstatus === "All") {
      filterbydate()
    }
    else {
          var ddate = new Date(2019, 7, 25);
          ddate.setFullYear(ddate.getFullYear() - 5);
          var dateNow = new Date()
          let startDate = ""
          let endDate = ""
          var Yesterdaydate = new Date(Date.now() - 86400000);
          let ldaybyes = 86400000*2
          let daybeforeyesterday = new Date(Date.now() - ldaybyes);
          let lastweekseconds = 86400000*7
          var lastweekdate = new Date(Date.now() - lastweekseconds);
          let lastmonthsecs = 8640000*30
          var lastmonthdate = new Date(Date.now() - lastmonthsecs);
          var tomorrowsdate = new Date(Date.now() + 86400000);
          let filterrange = document.getElementById("filter_range").value
          if(filterrange === "Today"){
            startDate = Yesterdaydate
            endDate = dateNow
          }
          else if(filterrange === "Yesterday"){
            startDate = daybeforeyesterday
            endDate = Yesterdaydate
          }
          else if(filterrange === "Last Week"){
            startDate = lastweekdate
            endDate = dateNow 
          }
          else if(filterrange === "Last Month"){
            startDate = lastmonthdate
            endDate = dateNow
          }
          else{
            let startdatecustom = document.getElementById("from_date_c").value
            let enddatecustom = document.getElementById("to_date_c").value
            startDate = new Date(startdatecustom)  
            endDate = new Date(enddatecustom) 

          }
          var aDate = new Date();
          var filteredData = teststatus.filter(function(a){
          let onlydateto = a.date_ordered.split('T')[0]
          aDate = new Date(onlydateto);
          console.log("aDate: "+aDate);
          console.log("startDate: "+Yesterdaydate);
          console.log("endDate: "+tomorrowsdate);
          return aDate >= startDate && aDate <= endDate && a.order_status === filterstatus;
          });
          console.log(filteredData)
          getfilteredordersdatatable(filteredData)
    }

  }

  function opendeletemodal(){
    $("#deleteModal").modal("show");
  }

      function filterbystatus(){
  console.log("filtering")
  let filstatus = document.getElementById("sel_status").value
  //let teststatussta = okchains.map(a => ({...a}));
  if(filstatus === "All"){
    console.log(okchains)
    getfilteredordersdatatable(okchains)
  }
  else {
      let teststatussta = okchains.map(a => ({...a}));
      //console.log(okchains)
  let result = teststatussta.filter(i => {
    console.log(i)
    return i.order_status === filstatus}) ; 
  console.log(result)
  let nresult = JSON.stringify(result)
  console.log(result)
  getfilteredordersdatatable(result)
  }

}



  function filterbydate(){
    var ddate = new Date(2019, 7, 25);
ddate.setFullYear(ddate.getFullYear() - 5);
    var dateNow = new Date()
    let startDate = ""
    let endDate = ""
        var Yesterdaydate = new Date(Date.now() - 86400000);
    let ldaybyes = 86400000*2
    let daybeforeyesterday = new Date(Date.now() - ldaybyes);
    let lastweekseconds = 86400000*7
    var lastweekdate = new Date(Date.now() - lastweekseconds);
    let lastmonthsecs = 8640000*30
    var lastmonthdate = new Date(Date.now() - lastmonthsecs);
    var tomorrowsdate = new Date(Date.now() + 86400000);
    let filterrange = document.getElementById("filter_range").value
    if(filterrange === "Today"){
      startDate = Yesterdaydate
      endDate = dateNow
    }
    else if(filterrange === "Yesterday"){
      startDate = daybeforeyesterday
      endDate = Yesterdaydate
    }
    else if(filterrange === "Last Week"){
      startDate = lastweekdate
      endDate = dateNow 
    }
    else if(filterrange === "Last Month"){
      startDate = lastmonthdate
      endDate = dateNow
    }
    else if(filterrange === "All"){
      startDate = ddate
      endDate = dateNow
    }
    else{
      let startdatecustom = document.getElementById("from_date_c").value
      let enddatecustom = document.getElementById("to_date_c").value
      startDate = new Date(startdatecustom)  
      endDate = new Date(enddatecustom) 
    }
    var aDate = new Date();
    let teststatusdate = okchains.map(a => ({...a}));
    var filteredData = teststatusdate.filter(function(a){
    let onlydateto = a.date_ordered.split('T')[0]
    aDate = new Date(onlydateto);
    console.log("aDate: "+aDate);
    console.log("startDate: "+Yesterdaydate);
    console.log("endDate: "+tomorrowsdate);
    return aDate >= startDate && aDate <= endDate;
    });
  console.log(filteredData)
  getfilteredordersdatatable(filteredData)
  }

  function getYesterdaysDate() {
    var date = new Date();
    date.setDate(date.getDate()-1);
    return date.getFullYear() + '-' + (date.getMonth()+1) + '-' + date.getDate();
}




  function toDataURL(url) {
    return fetch(url).then((response) => {
            return response.blob();
        }).then(blob => {
            return URL.createObjectURL(blob);
        });
}


async function download() {
        const a = document.createElement("a");
        a.href = await toDataURL("https://cdn1.iconfinder.com/data/icons/ninja-things-1/1772/ninja-simple-512.png");
        a.download = "myImage.png";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
}

  function getQueryStringValue (key) {  
  return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
}

  function logOutUser(){
    localStorage.clear();
    window.location  =  "login.html";
  }


  function checkAll()
 {
     var tablek = document.getElementById ('example1');
     var checkboxes = tablek.querySelectorAll ('input[type=checkbox]');
     var val = checkboxes[0].checked;
     for (var i = 0; i < checkboxes.length; i++) checkboxes[i].checked = val;
 }

  function printChecked(){
    var items=document.getElementsByName('todelete');
    var selectedItems=[];
    for(var i=0; i<items.length; i++){
      if(items[i].type=='checkbox' && items[i].checked==true)
        selectedItems.push(items[i].value);
    }
    // console.log(selectedItems);
    return selectedItems
  }     
</script>
<script>



  function getordercsvdata(oldorderjson){
    let oldorderref = oldorderjson.map(a => ({...a}))
    let ordercsv = oldorderref.map(order => {
      let productsref = order.products
      let productsstr = ""
      for(let i =0; i < productsref.length; i++){
        let prostr = `${productsref[i].product_name} (${productsref[i].quantity}) | `
        productsstr += prostr
      }
      order.productsdata = productsstr
      order.first_name = order.user_id.first_name
      order.last_name = order.user_id.last_name
      order.contact = order.user_id.contact
      order.email_id = order.user_id.email_id
      order.state = order.user_id.state
      order.address = order.user_id.address.replace(/,/g, '-')
      order.city = order.user_id.city
      order.pincode = order.user_id.pincode

      //delete keychain._id
      delete order.__v
      delete order._id
      delete order.products
      delete order.user_id
      delete order.is_paid
      delete order.is_delivered
      return order
    })
    //console.log(newkeychains)
    var ordercsvordered = JSON.parse(JSON.stringify( ordercsv, ["order_id","productsdata","date_ordered","payment_type","first_name","last_name","email_id","contact","address","state","city","pincode","sub_total","gst_tax","shipping","amount"]));
    return ordercsvordered
  }


    function getordercsvdatanew(oldorderjson){
    let oldorderref = oldorderjson.map(a => ({...a}))
    let ordercsv = []
    for(i=0; i < oldorderref.length; i++){
      let products = oldorderref[i].products
      oldorderref[i].first_name = oldorderref[i].user_id.first_name
      oldorderref[i].last_name = oldorderref[i].user_id.last_name
      oldorderref[i].contact = oldorderref[i].user_id.contact
      oldorderref[i].email_id = oldorderref[i].user_id.email_id
      oldorderref[i].state = oldorderref[i].user_id.state
      oldorderref[i].address = oldorderref[i].user_id.address.replace(/,/g, '-')
      oldorderref[i].city = oldorderref[i].user_id.city
      oldorderref[i].pincode = oldorderref[i].user_id.pincode
      //delete oldorderref[i].user_id
      delete oldorderref[i].is_paid
      delete oldorderref[i].is_delivered
      for(j =0; j < products.length; j++){
        console.log(products[j].product_name)
        console.log(products[j])
        oldorderref[i].product_name = products[j].product_name
        oldorderref[i].quantity = products[j].quantity
        oldorderref[i].size = products[j].size
        oldorderref[i].print_name = products[j].print_name
        oldorderref[i].cover_type = products[j].cover_type
        oldorderref[i].subamount = products[j].subtotal
        oldorderref[i].product_name = products[j].product_name
        var ordercsvn = { ...oldorderref[i] };
        ordercsv.push(ordercsvn)
      }
    }
    // let ordercsv = oldorderref.map(order => {
    //   let productsref = order.products
    //   let productsstr = ""
    //   for(let i =0; i < productsref.length; i++){
    //     let prostr = `${productsref[i].product_name} (${productsref[i].quantity}) | `
    //     productsstr += prostr
    //   }
    //   order.productsdata = productsstr
    //   order.first_name = order.user_id.first_name
    //   order.last_name = order.user_id.last_name
    //   order.contact = order.user_id.contact
    //   order.email_id = order.user_id.email_id
    //   order.state = order.user_id.state
    //   order.address = order.user_id.address.replace(/,/g, '-')
    //   order.city = order.user_id.city
    //   order.pincode = order.user_id.pincode

    //   //delete keychain._id
    //   delete order.__v
    //   delete order._id
    //   delete order.products
    //   delete order.user_id
    //   delete order.is_paid
    //   delete order.is_delivered
    //   return order
    // })
    //console.log(newkeychains)
    var ordercsvordered = JSON.parse(JSON.stringify( ordercsv, ["order_id","date_ordered","payment_type","first_name","last_name","email_id","contact","address","state","city","pincode","product_name","size","print_name","cover_type","quantity", "subamount"]));
    console.log("ordercsv")
    console.log(ordercsv)
    return ordercsvordered
  }


  function getkeychains(oldkeychains){
    //let tokeyc = oldkeychains.reverse()
    // console.log(oldkeychains)
    let foruser = oldkeychains.map(a => ({...a}))
    let newkeychains = foruser.map(keychain => {
      //delete keychain._id
      delete keychain.__v
      delete keychain.available_status
      delete keychain.is_paid
      delete keychain.is_delivered
      return keychain
    })
    //console.log(newkeychains)
    return newkeychains
  }

  function canceldelete(){
    $("#deleteModal").modal("hide");
  }

  function deletekeychains(){
    //let deleteprotoget = globalProduct
    let todeleteids = printChecked()
    let deleteArray = {
      todeleteids
    }
              fetch(`http://${hosturl}:5600/api/order/deleteorder`,
          {
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            },
            method: "DELETE",
            body: JSON.stringify(deleteArray)
          })
          .then(function(res){ 
            $("#deleteModal").modal("hide");
            getordersdatatable()
          })
          .catch(function(res){ console.log(res) })
  }

    function productdetailsmodal(probtn){
      let proid = probtn.getAttribute('data-pid')
      let orderid = probtn.getAttribute('data-oid')
      // console.log(proid)
      fetch(`http://${hosturl}:5600/api/order/getcartproductbyid/${proid}`)
      .then(response => {
        //console.log(result)
        //$("#deleteModal").modal("hide");
        return response.json()
      })
      .then(result => {
        // console.log(result)
        document.getElementById("cart_p_name").innerHTML = result.product_name
        document.getElementById("cart_order_id").innerHTML = orderid
        document.getElementById("cart_p_printname").innerHTML = result.print_name ? result.print_name : "N.A."
        document.getElementById("cart_p_size").innerHTML = result.size ? result.size : "N.A."
        document.getElementById("cart_p_quantity").innerHTML = result.quantity ? result.quantity : "N.A."
        document.getElementById("cart_p_covertype").innerHTML = result.cover_type ? result.cover_type : "N.A."
        productGimagefull = result.image ? result.image : "noimage.png" 
        productGimagecropped = result.cropped_image ? result.cropped_image : "noimage.png" 
        document.getElementById("cart_p_image").src = `http://${hosturl}:5600/admin/uploads/${result.image}`
        document.getElementById("cart_p_c_image").src = `http://${hosturl}:5600/admin/uploads/${productGimagecropped}`
        // document.getElementById("cart_p_d_image").href = `http://${hosturl}:5600/admin/uploads/${result.image}`
        // document.getElementById("cart_p_d_image").download= `http://${hosturl}:5600/admin/uploads/${result.image}`
        $('#cartProductModal').modal('show');

      })
      .catch(err => {
        console.log(err)
      })
    }

        function userdetailsmodal(probtn){
      let proid = probtn.getAttribute('data-pid')
      // console.log(proid)
      fetch(`http://${hosturl}:5600/api/user/getuser/${proid}`)
      .then(response => {
        //console.log(result)
        return response.json()
      })
      .then(result => {
        // console.log(result)
        let full_name = result.first_name + " " + result.last_name
        let address = result.address

        document.getElementById("cart_u_name").innerHTML = full_name ? full_name : "N.A."
        document.getElementById("cart_u_contact").innerHTML = result.contact ? result.contact : "N.A."
        document.getElementById("cart_u_email").innerHTML = result.email_id ? result.email_id : "N.A."
        document.getElementById("cart_u_address").innerHTML = address ? address : "N.A."
        document.getElementById("cart_u_pincode").innerHTML = result.pincode ? result.pincode : "N.A."
        document.getElementById("cart_u_city").innerHTML = result.city ? result.city : "N.A."
        document.getElementById("cart_u_state").innerHTML = result.state ? result.state : "N.A."
        // document.getElementById("cart_u_country").innerHTML = result.country ? result.country : "N.A."
        // document.getElementById("cart_u_addresstype").innerHTML = result.address_type ? result.address_type : "N.A."
        
        $('#cartUserModal').modal('show');

      })
      .catch(err => {
        console.log(err)
      })
    }




    function changeorderstatus(selop){
      let orderid = selop.getAttribute('data-oid')
      // console.log("orderef",orderref)
      // let orderid = okchains[orderref]._id
      console.log("orderid",orderid)
      let foridf = `order_status_ind_${orderid}`
      let newstatus = document.getElementById(foridf).value
      console.log("newstatus",newstatus)
      let statusbody = {
        order_status : newstatus
      }
          fetch(`http://${hosturl}:5600/api/order/changeorderstatus/${orderid}`,
{
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    method: "PUT",
    body: JSON.stringify(statusbody)
})
.then(function(res){ 
  return res.json()
  })
.then(function(result){
  // console.log(result)
  //let productId = result.product._id
 // console.log(productId)
  document.getElementById(foridf).value = ""
  getordersdatatable()
  //uploadFile(productId)
  //getord
  
})
.catch(function(res){ console.log(res) })

      console.log(newstatus)
    }

    function CreateTableFromJSON(myBookso) {
      let myBooksoldnew = getkeychains(myBookso)
      let myBooksold = myBooksoldnew.map(a => ({...a}))
      // console.log("orders")
      // console.log(myBooksold)
      let myBooks= myBooksold.map(a => {
        // console.log(a)
        let fullname = a.user_id.first_name + " " + a.user_id.last_name 
        Object.assign(a, {name: fullname})
        Object.assign(a, {contact: a.user_id.contact});
        Object.assign(a, {email_id: a.user_id.email_id});
        Object.assign(a, {address: a.user_id.address})
        delete a['user_id'];
        return a
      });
      const removePropery = (propKey, { [propKey]: propValue, ...rest }) => rest;
      //myBooks = removePropery('user_id', myBooks);
      // console.log(myBooks)

      // var myBooks = JSON.parse(JSON.stringify( myBooksrow, ["name","contact","email","products","payment_type","is_paid","is_delivered"]));

      // console.log(myBooks)
      let thorders = ["Products","id","Order Id","GST","Shipping","Subtotal","Amount","Order Status","Payment Type","Date","Name","Contact","Email","Address"]

        var col = [];
        for (var i = 0; i < myBooks.length; i++) {
            for (var key in myBooks[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }

        // CREATE DYNAMIC TABLE.
        var table = document.createElement("table");
        table.setAttribute("class", "table table-striped auto-index");
        table.setAttribute("id","keychaintable")
        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);  
        //tr.setAttribute("contenteditable", "true");                 // TABLE ROW.

        for (var i = -1; i < col.length; i++) {
            var th = document.createElement("th");  
                // TABLE HEADER.
                if(i === -1){
                  th.innerHTML = "No."
                }
                else if(i === 1){

                }
                else {
                  th.innerHTML = thorders[i];
                }
            
            tr.appendChild(th);

        }
       // var thn =  document.createElement("th"); 
      //  thn.innerHTML = "Edit";
            //tr.appendChild(thn);
        var ths = document.createElement("th")
        ths.innerHTML = "<div class='form-group'><div class='custom-control custom-checkbox'><input onclick=checkAll() class='custom-control-input' type='checkbox' id='customCheckbox2' value='option1'><label for='customCheckbox2' class='custom-control-label'>All</label></div></div>"

        // ths.innerHTML = "<div class='form-group'><div class='custom-control custom-checkbox'><input onclick=checkAll() class='custom-control-input' type='checkbox' id='customCheckbox2' value='option1'><label for='customCheckbox2' class='custom-control-label'>Select All</label></div></div>"
        tr.appendChild(ths);

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < myBooks.length; i++) {

            tr = table.insertRow(-1);
            //tr.setAttribute("contenteditable", "true"); 
            for (var j = -1; j < col.length; j++) {
              var tabCell = tr.insertCell(-1);
              if(j === -1){
                tabCell.innerHTML = ""
              }
              else if(j===0){
                //console.log(myBooks[i][col[j]])
                let products = myBooks[i][col[j]]
                // console.log(products)
                let products_name = ''
                for(let i=0; i < products.length; i++){
                  // console.log()
                  let btntag =  `<button onclick="productdetailsmodal(this)" style="padding: 1px 1px; margin-top:3px;font-size:14px;color:green" class="btn" data-pid="${products[i]._id}">${products[i].product_name}</button>`
                  products_name += `${btntag} </br> `
                }
                // console.log(products_name)
                tabCell.innerHTML = products_name
              }
              else if(j===2){
                let orderid = myBookso[i]._id
                let atag = document.createElement('a')
                atag.innerHTML = myBooks[i][col[j]]
                let ahref = `invoice.html#${orderid}`
                atag.setAttribute('href',ahref)
                tabCell.appendChild(atag)
              }
              else if(j === 1){

              }
              else if(j===13){
                let userinfo = myBooks[i][col[j]]
                console.log(myBooksoldnew[i])
                let user = myBooksoldnew[i].user_id._id
                console.log("below user")
                // console.log(user)
                let btntag2 =  `<button onclick="userdetailsmodal(this)" style="padding: 1px 1px; margin:5px" class="btn btn-info" data-pid="${user}">view</button>`
                tabCell.innerHTML = btntag2
              }
                  else if(j===7){
                 let valueStatus = myBooks[i][col[j]]   
                 let spantag = document.createElement('span')
                 spantag.setAttribute('id','order_status_span')
                 if(myBooks[i][col[j]] === "Shipped"){
                  spantag.innerHTML = "Shipped"
                  spantag.setAttribute('class', 'badge badge-success')
                 }
                 else if(myBooks[i][col[j]] === "Pending"){
                  spantag.innerHTML = "Pending"
                  spantag.setAttribute('class', 'badge badge-warning')
                 }
                 else if(myBooks[i][col[j]] === "Delivered"){
                  spantag.innerHTML = "Delivered"
                  spantag.setAttribute('class', 'badge badge-danger')
                 }
                 else{
                  spantag.innerHTML = "Processing"
                  spantag.setAttribute('class', 'badge badge-info')
                 }
                 let orderreftable = myBooks[i]._id
                 let forid = `order_status_ind_${orderreftable}`
                let btntag3 =  `<select data-oid=${orderreftable} onchange="changeorderstatus(this)" style="width:50%" value="Delivered" id="${forid}" class="form-control custom-select custom-select-nn"><option value=""></option><option value="Shipped">Shipped</option><option id="Delivered" value="Delivered">Delivered</option><option value="Pending">Pending</option><option value="Processing">Processing</option></select>`
                //document.getElementById('order_status_ind').value="Delivered";
                tabCell.appendChild(spantag)
                tabCell.innerHTML += btntag3
              }

              else if(j === 9){
                let onlydate = myBooks[i][col[j]].split('T')[0]
                tabCell.innerHTML = onlydate
              }

              else{
                tabCell.innerHTML = myBooks[i][col[j]];
              }
              
              
              //console.log(i, j)
              }
          //  console.log(myBooks[i])
             // let delbtn = document.createElement("button")
             // delbtn.setAttribute("class", "btn btn-danger");
             // delbtn.innerHTML = "Delete"
             // delbtn.style.margin = "5px";
            let editbtn = document.createElement("button")
            editbtn.setAttribute("class", "btn btn-primary");
            editbtn.style.marginRight = "2px";
            editbtn.setAttribute("onclick", "editproduct(this)");
            editbtn.setAttribute("data-toggle", "modal");
            editbtn.setAttribute("data-target", "#myModal");
            editbtn.setAttribute("data-key",i)
            // delbtn.setAttribute("data-key",i)
            // delbtn.setAttribute("onclick", "deleteproduct(this)")
            editbtn.style.padding = "1px 5px";
            // delbtn.style.padding = "1px 5px";
            editbtn.innerHTML = "Edit"
            let td = document.createElement("td");
            td.style.padding = "5px";
            let std = document.createElement("td");
            let deleteCheck = document.createElement("input")
            deleteCheck.setAttribute("type","checkbox")
            deleteCheck.setAttribute("name","todelete")
            deleteCheck.setAttribute("value",myBooks[i]._id)

            // console.log(deleteCheck)
            std.appendChild(deleteCheck)
            td.appendChild(editbtn)
            // td.appendChild(delbtn)
            //tr.appendChild(td)
            tr.appendChild(std)
        }

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("samplejson");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
    }
      function getproducts(){
        //globalProduct = proname
        // document.getElementById("productAddHeading").innerHTML = "Add "+globalProduct
        // document.getElementById("productEditHeading").innerHTML = "Edit "+globalProduct
        // document.getElementById("productShowHeading").innerHTML = globalProduct
        // document.getElementById("add_keychain").value = "Add "+globalProduct
        // document.getElementById("productEditBtn").value = "Add "+globalProduct
        // let producttoget = proname
        // let getpropara = producttoget + "s"
    fetch(`http://${hosturl}:5600/api/order/getorderswithdata`)
    .then(response => {
     // console.log(response)
      return response.json()})
    .then(data => {
       let okchainsold = data.map(a => ({...a}));
       okchains = okchainsold.reverse()
     // filterorders()
      //CreateTableFromJSON(data)
   })
    .catch(err => console.log(err))
}

getproducts()
      // let filters = ["name", "size", "price"]
      // let ndata = JSON.parse(unfiltered).map(function(currObj) {
      // var temp = {};
      // for identifier in filters:
      //   temp[identifier] = currObj[identifier];
      // return temp;
      // });

        function checkLogin(){
    
    if (localStorage.getItem("luser") === null) {
     // $('#loggedIn').css("display","none")
       // $('#logintosee').html("login to see the registered users")
       // $('#notloggedbtn').css("display","block")
        window.location = "login.html";
      //  console.log(ran)
    }
    else{
      // console.log(localStorage.getItem("luser"))
      //var loguser = JSON.parse(localStorage.getItem('luser'));
      //var username = loguser.name;

      var authtokend = localStorage.getItem('authorization')
      // console.log(authtokend)
      
      //console.log(username)   
       }
  }
  checkLogin()


    function convertToCSV(objArray) {
    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
    var str = '';

    for (var i = 0; i < array.length; i++) {
        var line = '';
        for (var index in array[i]) {
            if (line != '') line += ','

            line += array[i][index];
        }

        str += line + '\r\n';
    }

    return str;
}

function exportCSVFile(headers, items, fileTitle) {
    if (headers) {
        items.unshift(headers);
    }

    // Convert Object to JSON
    var jsonObject = JSON.stringify(items);

    var csv = this.convertToCSV(jsonObject);

    var exportedFilenmae = fileTitle + '.csv' || 'export.csv';

    var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    if (navigator.msSaveBlob) { // IE 10+
        navigator.msSaveBlob(blob, exportedFilenmae);
    } else {
        var link = document.createElement("a");
        if (link.download !== undefined) { // feature detection
            // Browsers that support HTML5 download attribute
            var url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", exportedFilenmae);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }
}

 ["order_id","date_ordered","payment_type","first_name","last_name","email_id","contact","address","state","city","pincode","product_name","size","print_name","cover_type","quantity", "subamount"]

function download(){
  var headers = {
      order_id : "Order Id",
      date_ordered: "Date",
      payment_type: "Payment Method",
      first_name: "Customer First Name",
      last_name: "Customer Last Name",
      email_id :"Email",
      contact :"Contact",
      address :"Address", 
      state :"State",
      city  :"City",
      pincode: "Pincode",
      product_name: "Product Name",
      size: "Size",
      print_name: "print_name",
      cover_type :"Cover Type",
      quantity : "Quantity",
      subamount : "Subamount"
  };

  itemsNotFormatted = getordercsvdatanew(okchains)

  var itemsFormatted = [];

  // format the data
  itemsNotFormatted.forEach((item) => {
      itemsFormatted.push({
          name: item.first_name, 
          contact: item.contact,
          email: item.email_id,
          city: item.city
      });
  });

  var fileTitle = 'orders'; // or 'my-unique-title'

  exportCSVFile(headers, itemsNotFormatted, fileTitle); // call the exportCSVFile() function to process the JSON and trigger the download



}


    function getordersdatatable(){
          let userTable = $('#example1').DataTable({
            destroy: true,
        "processing" : true,
          "rowCallback": function (nRow, aData, iDisplayIndex) {
               var oSettings = this.fnSettings ();
               $("td:first", nRow).html(oSettings._iDisplayStart+iDisplayIndex +1);
               return nRow;
          },
        "ajax" : {
            "url" : `http://${hosturl}:5600/api/order/getorderswithdata`,
            dataSrc : ''
        },
        "columns" : [ {
            "data" : null
        }, {
            "data" : null,
            "mRender": function(data, type){
              let orderid = data._id
              let atag = `<a href='invoice.html#${orderid}'>${data.order_id}</a>`
              return atag
            }
        }, {
            "data" : null,
            "mRender" : function(data, type){
                let products_name = ''
                let productsref = data.products
                let order_id = data.order_id
                for(let i=0; i < productsref.length; i++){
                  // console.log()

                  let btntag =  `<button onclick="productdetailsmodal(this)" style="padding: 1px 1px; margin-top:3px;font-size:14px;color:green" class="btn" data-oid=${order_id} data-pid="${productsref[i]._id}">${productsref[i].product_name}</button>`
                  products_name += `${btntag} </br> `
                }
              return products_name
            }
        },{
            "data" : "amount",
              "mRender" : function(data, type){
              let amou = `${data} `
              return amou
            }
        }, {
            "data" : "payment_type"
        },{
            "data" : "date_ordered",
            "mRender" : function(data, type){
              let date = data.split("T")[0].split('-').reverse().join('-')
              return date
            }
        }, {
          "data": "user_id",
            "mRender": function(data, type) {
             
              return `<button onclick="userdetailsmodal(this)" style="padding: 1px 1px; margin:5px" class="btn btn-info" data-pid="${data._id}">view</button>`;
            }
        },{
          "data":null,
            "mRender": function(data,type){
              let orderreftable = data._id
              console.log(orderreftable)
              console.log(data.order_status)
                 let forid = `order_status_ind_${orderreftable}`
                let btntag3 =  `<select data-oid=${orderreftable} onchange="changeorderstatus(this)" style="width:15%" value="Delivered" id="${forid}" class="form-control custom-select custom-select-nn"><option value=""></option><option value="Pending Payment">Pending Payment</option><option value="Failed">Failed</option><option value="On Hold">On Hold</option><option value="Processing">Processing</option><option value="Refunded">Refunded</option><option value="Trash">Trash</option><option value="Completed">Completed</option></select>`
          
              let spantag = ""
                 if(data.order_status === "Pending Payment"){
                  spantag = `<span id="span_status" class="badge badge-warning">Pending Payment</span>`
                 }
                   else if(data.order_status === "Processing"){
                  spantag = `<span id="span_status" class="badge badge-success">Processing</span>`
                 }
                 else if(data.order_status === "Failed"){
                  spantag = `<span id="span_status" class="badge badge-danger">Failed</span>`
                 }
                  else if(data.order_status === "On Hold"){
                  spantag = `<span id="span_status" class="badge badge-info">On Hold</span>`
                 }
                  else if(data.order_status === "Refunded"){
                  spantag = `<span id="span_status" class="badge badge-warning">Refunded</span>`
                 }
                   else if(data.order_status === "Trash"){
                  spantag = `<span id="span_status" class="badge badge-danger">Trash</span>`
                 }
                   else if(data.order_status === "Completed"){
                  spantag = `<span id="span_status" class="badge badge-success">Completed</span>`
                 }


                 else{
                  console.log(data.order_status)
                  spantag = `<span id="span_status" class="badge badge-info">old</span>`
                 }
                 spantag += btntag3
                 return spantag
            }
        }, {
          "data": "_id",
            "mRender": function(data, type) {
             
              return `<input name="todelete" value=${data} type="checkbox">`;
            }
        }]
    });
    }

    function getfilteredordersdatatable(newdata){
          let userTable = $('#example1').DataTable({
            destroy: true,
        "processing" : true,
          "rowCallback": function (nRow, aData, iDisplayIndex) {
               var oSettings = this.fnSettings ();
               $("td:first", nRow).html(oSettings._iDisplayStart+iDisplayIndex +1);
               return nRow;
          },
            "aaData" : newdata
        ,
        "columns" : [ {
            "data" : null
        }, {
            "data" : null,
            "mRender": function(data, type){
              let orderid = data._id
              let atag = `<a href='invoice.html#${orderid}'>${data.order_id}</a>`
              return atag
            }
        }, {
            "data" : null,
            "mRender" : function(data, type){
                let products_name = ''
                let productsref = data.products
                let order_id = data.order_id
                for(let i=0; i < productsref.length; i++){
                  // console.log()

                  let btntag =  `<button onclick="productdetailsmodal(this)" style="padding: 1px 1px; margin-top:3px;font-size:14px;color:green" class="btn" data-oid=${order_id} data-pid="${productsref[i]._id}">${productsref[i].product_name}</button>`
                  products_name += `${btntag} </br> `
                }
              return products_name
            }
        },{
            "data" : "amount",
              "mRender" : function(data, type){
              let amou = `${data} `
              return amou
            }
        }, {
            "data" : "payment_type"
        },{
            "data" : "date_ordered",
            "mRender" : function(data, type){
              let date = data.split("T")[0]
              return date
            }
        },  {
          "data": "user_id",
            "mRender": function(data, type) {
             
              return `<button onclick="userdetailsmodal(this)" style="padding: 1px 1px; margin:5px" class="btn btn-info" data-pid="${data._id}">view</button>`;
            }
        },{
          "data":null,
            "mRender": function(data,type){
              let orderreftable = data._id
              console.log(orderreftable)
              console.log(data.order_status)
                 let forid = `order_status_ind_${orderreftable}`
                let btntag3 =  `<select data-oid=${orderreftable} onchange="changeorderstatus(this)" style="width:15%" value="Delivered" id="${forid}" class="form-control custom-select  custom-select-nn"><option value=""></option><option value="Pending Payment">Pending Payment</option><option id="Failed" value="Failed">Delivered</option><option value="On Hold">On Hold</option><option value="Processing">Processing</option><option value="Refunded">Refunded</option><option value="Trash">Trash</option><option value="Completed">Completed</option></select>`
          
              let spantag = ""
                 if(data.order_status === "Pending Payment"){
                  spantag = `<span id="span_status" class="badge badge-warning">Pending Payment</span>`
                 }
                   else if(data.order_status === "Processing"){
                  spantag = `<span id="span_status" class="badge badge-success">Processing</span>`
                 }
                 else if(data.order_status === "Failed"){
                  spantag = `<span id="span_status" class="badge badge-danger">Failed</span>`
                 }
                  else if(data.order_status === "On Hold"){
                  spantag = `<span id="span_status" class="badge badge-info">On Hold</span>`
                 }
                  else if(data.order_status === "Refunded"){
                  spantag = `<span id="span_status" class="badge badge-warning">Refunded</span>`
                 }
                   else if(data.order_status === "Trash"){
                  spantag = `<span id="span_status" class="badge badge-danger">Trash</span>`
                 }
                     else if(data.order_status === "Completed"){
                  spantag = `<span id="span_status" class="badge badge-success">Completed</span>`
                 }

                 else{
                  console.log(data.order_status)
                  spantag = `<span id="span_status" class="badge badge-info">old</span>`
                 }
                 spantag += btntag3
                 return spantag
            }
        }, {
          "data": "_id",
            "mRender": function(data, type) {
             
              return `<input name="todelete" value=${data} type="checkbox">`;
            }
        }]
    });
    }

getordersdatatable()
  
    
</script>

<script type="text/javascript">

</script>
</body>
</html>
